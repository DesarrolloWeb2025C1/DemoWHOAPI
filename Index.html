<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>WHO API — Demo Front + JSON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #0f172a; color: #e5e7eb; margin: 0; }
    header { padding: 10px; background: #1e293b; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    select, input, button { padding: 6px; border-radius: 4px; border: none; }
    button { background: #22d3ee; color: #000; font-weight: bold; cursor: pointer; }
    main { padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; }
    strong { color: #a5f3fc; }
    pre { background: #0b1220; padding: 10px; border-radius: 6px; color: #a5f3fc; overflow-x: auto; }
  </style>
</head>
<body>
  <header>
    <div>
      <label for="country">País</label>
      <select id="country">
  <option value="AFG">Afghanistan</option>
  <option value="ARG">Argentina</option>
  <option value="AUS">Australia</option>
  <option value="AUT">Austria</option>
  <option value="BEL">Belgium</option>
  <option value="BOL">Bolivia</option>
  <option value="BRA">Brazil</option>
  <option value="CAN">Canada</option>
  <option value="CHL">Chile</option>
  <option value="CHN">China</option>
  <option value="COL">Colombia</option>
  <option value="CRI">Costa Rica</option>
  <option value="CUB">Cuba</option>
  <option value="CZE">Czechia</option>
  <option value="DNK">Denmark</option>
  <option value="DOM">Dominican Republic</option>
  <option value="ECU">Ecuador</option>
  <option value="EGY">Egypt</option>
  <option value="ESP">Spain</option>
  <option value="EST">Estonia</option>
  <option value="FIN">Finland</option>
  <option value="FRA">France</option>
  <option value="GBR">United Kingdom</option>
  <option value="DEU">Germany</option>
  <option value="GRC">Greece</option>
  <option value="GTM">Guatemala</option>
  <option value="HND">Honduras</option>
  <option value="HUN">Hungary</option>
  <option value="IND">India</option>
  <option value="IDN">Indonesia</option>
  <option value="IRL">Ireland</option>
  <option value="ISR">Israel</option>
  <option value="ITA">Italy</option>
  <option value="JPN">Japan</option>
  <option value="KOR">South Korea</option>
  <option value="MEX">Mexico</option>
  <option value="NLD">Netherlands</option>
  <option value="NZL">New Zealand</option>
  <option value="NIC">Nicaragua</option>
  <option value="NOR">Norway</option>
  <option value="PAN">Panama</option>
  <option value="PRY">Paraguay</option>
  <option value="PER">Peru</option>
  <option value="POL">Poland</option>
  <option value="PRT">Portugal</option>
  <option value="ROU">Romania</option>
  <option value="RUS">Russian Federation</option>
  <option value="SLV">El Salvador</option>
  <option value="ZAF">South Africa</option>
  <option value="SWE">Sweden</option>
  <option value="CHE">Switzerland</option>
  <option value="TUR">Turkey</option>
  <option value="UKR">Ukraine</option>
  <option value="USA">United States</option>
  <option value="URY">Uruguay</option>
  <option value="VEN">Venezuela</option>
</select>
    </div>
    <div>
      <label for="year">Año</label>
      <select id="year">
  <option value="2024">2024</option>
  <option value="2023">2023</option>
  <option value="2022">2022</option>
  <option value="2021">2021</option>
  <option value="2020">2020</option>
  <option value="2019">2019</option>
  <option value="2018">2018</option>
  <option value="2017">2017</option>
  <option value="2016">2016</option>
  <option value="2015">2015</option>
  <option value="2014">2014</option>
  <option value="2013">2013</option>
  <option value="2012">2012</option>
  <option value="2011">2011</option>
  <option value="2010">2010</option>
  <option value="2005">2005</option>
  <option value="2000">2000</option>
  <option value="1995">1995</option>
  <option value="1990">1990</option>
</select>
    </div>
    <div>
      <label for="indicator">Indicador</label>
      <input type="text" id="indicator" value="WHOSIS_000001" />
    </div>
    <button id="run">Consultar</button>
    <button id="reset">Limpiar</button>
  </header>

  <main>
    <!-- Panel Front -->
    <div class="card">
      <h3>Resultado</h3>
      <p><strong>País:</strong> <span id="f-country">—</span></p>
      <p><strong>Año:</strong> <span id="f-year">—</span></p>
      <p><strong>Indicador:</strong> <span id="f-indicator">—</span></p>
      <p><strong>Valor:</strong> <span id="f-value">—</span></p>
    </div>

    <!-- Panel JSON crudo -->
    <div class="card">
      <h3>JSON crudo</h3>
      <pre id="raw">{ /* Esperando consulta… */ }</pre>
    </div>
  </main>

  <script>
    const API_BASE = 'http://localhost:3000/who';

    const $country = document.getElementById('country');
    const $year = document.getElementById('year');
    const $indicator = document.getElementById('indicator');
    const $run = document.getElementById('run');
    const $reset = document.getElementById('reset');

    const $fCountry = document.getElementById('f-country');
    const $fYear = document.getElementById('f-year');
    const $fIndicator = document.getElementById('f-indicator');
    const $fValue = document.getElementById('f-value');
    const $raw = document.getElementById('raw');

    async function runQuery() {
      const country = $country.value;
      const year = $year.value;
      const indicator = $indicator.value.trim();

      const endpoint = `${API_BASE}?indicator=${indicator}&country=${country}&year=${year}`;
      console.log("Consultando:", endpoint);

      try {
        const res = await fetch(endpoint);
        const data = await res.json();

        // Mostrar JSON crudo
        $raw.textContent = JSON.stringify(data, null, 2);

        // Mostrar datos en el front
        $fCountry.textContent = $country.options[$country.selectedIndex].text;
        $fYear.textContent = year;
        $fIndicator.textContent = indicator;

        if (!data.value || data.value.length === 0) {
          $fValue.textContent = 'Sin datos para este año';
        } else {
          const row = data.value.find(r => (r.Sex || r.Dim1 || '').toLowerCase().includes('both')) || data.value[0];
          const num = row?.NumericValue;
          $fValue.textContent = (typeof num === 'number')
            ? `${num.toFixed(2)} (valor original: ${num})`
            : '—';
        }
      } catch (err) {
        console.error("Error:", err);
        $fValue.textContent = 'Error al consultar';
        $raw.textContent = JSON.stringify({ error: err.message }, null, 2);
      }
    }

    $run.addEventListener('click', runQuery);
    $reset.addEventListener('click', () => {
      $fCountry.textContent = '—';
      $fYear.textContent = '—';
      $fIndicator.textContent = '—';
      $fValue.textContent = '—';
      $raw.textContent = '{ /* Esperando consulta… */ }';
    });
  </script>
</body>
</html>